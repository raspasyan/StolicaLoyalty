function updatePersonalData(){getProfileData().then(a=>{if(a.status){if((a.data.firstname||a.data.middlename||a.data.lastname)&&C("#personal_name").text([a.data.firstname,a.data.middlename,a.data.lastname].join(" ")),a.data.birthdate){let e=new Date(a.data.birthdate.replace(new RegExp("-","g"),"/"));C("#personal_birthdate").text(e.toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",timezone:"UTC"}))}var e;a.data.phone&&(e=a.data.phone.split(""),C("#personal_phone").text("+"+e[0]+" ("+e[1]+e[2]+e[3]+") "+e[4]+e[5]+e[6]+"-"+e[7]+e[8]+"-"+e[9]+e[10])),C("#personalCardType").text(a.data.preferred_discount?"ДИСКОНТНАЯ":"БОНУСНАЯ"),a.data.discount!==a.data.preferred_discount?(show("#notMatchCardType"),C("#notMatchCardTypeValue").text(a.data.discount?"БОНУСНОЙ":"ДИСКОНТНОЙ")):hide("#notMatchCardType")}else onErrorCatch(a)})}function drawPersonal(t){if((t.firstname||t.middlename||t.lastname)&&C("#personal_name").text([t.firstname,t.middlename,t.lastname].join(" ")),t.birthdate){let e=new Date(t.birthdate.replace(new RegExp("-","g"),"/"));C("#personal_birthdate").text(e.toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",timezone:"UTC"}))}t.phone&&(a=t.phone.split(""),C("#personal_phone").text("+"+a[0]+" ("+a[1]+a[2]+a[3]+") "+a[4]+a[5]+a[6]+"-"+a[7]+a[8]+"-"+a[9]+a[10])),C("#personalCardType").text(t.preferred_discount?"ДИСКОНТНАЯ":"БОНУСНАЯ"),t.discount!==t.preferred_discount?(show("#notMatchCardType"),C("#notMatchCardTypeValue").text(t.discount?"БОНУСНОЙ":"ДИСКОНТНОЙ")):hide("#notMatchCardType")}function getProfileData(){return fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+(bearerToken||"")},body:JSON.stringify({method:"getProfileData"})}).then(e=>e.json()).catch(e=>({status:!1,description:e.message,error:e}))}async function changePassword(){let e=!1;if(0===C("#personal_new_pass").val().length)return e;if(0<C("#personal_new_pass").val().length&&C("#personal_new_pass").val().length<6)return attentionFocus(C("#personal_new_pass").el),e;if(C("#personal_new_pass").val()!==C("#personal_new_pass_confirmation").val())return attentionFocus(C("#personal_new_pass_confirmation").el),e;C("#personal_changePassword_button").el.disabled=!0;let a=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+(bearerToken||"")},body:JSON.stringify({method:"changePassword",data:{new_password:C("#personal_new_pass").val()}})});return e=await a.json(),C("#personal_changePassword_button").el.disabled=!1,e}async function changeCard(){if(C("#personal_new_card").val().length<14)attentionFocus(C("#personal_new_card").el);else{C("#personal_changeCard_button").el.disabled=!0;let e=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+(bearerToken||"")},body:JSON.stringify({method:"changeCard",data:{new_card:C("#personal_new_card").val()}})});var a=await e.json();C("#personal_changeCard_button").el.disabled=!1,a.status?(a.description&&showPopup("",a.description),C("#personal_new_pass").val(""),C("#personal_new_pass_confirmation").val("")):a.description&&showPopup("Внимание",a.description)}}function changeCardType(){return fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+(bearerToken||"")},body:JSON.stringify({method:"changeCardType",data:{discount:C('input[name="systemChange"]:checked').val()}})}).then(e=>e.json()).catch(e=>({status:!1,description:e.message,error:e}))}function changeProfileData(){let a=!1;0<C("#personal_new_pass").val().length?(changePassword().then(e=>{e&&(e.status?a=!0:showPopup("Внимание",e.description))}),setTimeout(()=>{a&&changeCardType().then(e=>{e.status&&showPopup("","Данные профиля изменены!")})},500)):changeCardType().then(e=>{e.status&&showPopup("","Тип карты изменен!")})}async function setCard(){if(C("#plasticNumber").val().length<10)showPopup("Внимание","Не указан номер карты!");else{showLoader(),C("#set_card").el.disabled=!0;var a={method:"setCard",data:{card_number:C("#plasticNumber").val()}};let e=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+(bearerToken||"")},body:JSON.stringify(a)});a=await e.json();C("#personal_changePassword_button").el.disabled=!1,hideLoader(),C("#set_card").el.disabled=!1,C("#plasticNumber").val(""),a.status?a.description&&showPopup("",a.description):a.description&&showPopup("Внимание",a.description)}}