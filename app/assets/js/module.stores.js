function drawStores(s){let t=[];s.forEach(e=>{-1===t.indexOf(e.id)&&t.push(e.id)}),t.forEach(t=>{let a=[],e=(s.forEach(e=>{e.id===t&&a.push(e)}),C().create("option"));e.val(t),e.attr("data-stores",JSON.stringify(a)),e.text(a[0].title),C("#store_cities").append(e),a[0].title===currentCity&&e.attr("selected",!0)}),drawStoresInCity(JSON.parse(C("#store_cities").el.options[C("#store_cities").el.selectedIndex].getAttribute("data-stores")))}function drawStoresInCity(e){let o=C(".storesList"),n=1;o.html(""),e.forEach(t=>{let e=C().create("div"),a=(e.addclass(["storesList__block","animate__animated","animate__fadeInLeft"]),e.attr("style","animation-duration: "+n/5+"s"),e.el.addEventListener("click",e=>getStoreToGeoMap(t.coordinates,t.title,t.store_title,t.shedule,t.phone,t.rsa_id)),C().create("div")),s=(a.addclass("storesList__block_title"),a.text(t.store_title),e.el.append(a.el),C().create("div"));s.addclass("storesList__block_shedule"),s.text(t.shedule),e.el.append(s.el),o.el.append(e.el),n<10&&n++})}function getStores(){return fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({method:"getStores"})}).then(e=>e.json()).catch(e=>({status:!1,description:e.message,error:e}))}function closeStore(){d.body.removeChild(C(".storeMap").el)}function getStoreToGeoMap(e,t,a,s,o,n){let r=C().create("div"),i=(r.addclass("storeMap"),C().create("div")),l=(i.addclass("storeMap__bg"),i.el.addEventListener("click",e=>closeStore()),r.append(i),C().create("div")),c=(l.addclass(["storeMap__block","animate__animated","animate__fadeInDown"]),r.append(l),C().create("div")),p=(c.addclass("storeMap__block_city"),c.text(t),l.append(c),C().create("i")),_=(p.addclass("icon-cancel"),p.id="closeStore",c.append(p),p.el.addEventListener("click",e=>closeStore()),C().create("div")),h=(_.addclass("storeMap__block_info"),l.append(_),C().create("div")),m=(h.html("<span>Адрес:</span><span>"+a+"</span>"),_.append(h),(h=C().create("div")).html("<span>Время работы:</span><span>"+s+"</span>"),_.append(h),(h=C().create("div")).html("<span>Телефон:</span><span><a href='tel:+7"+o.slice(1)+"'>"+o+"</a></span>"),_.append(h),C().create("div"));m.attr("id","map"),l.append(m),d.body.appendChild(r.el);t=parseFloat(e.split(",")[0]),s=parseFloat(e.split(",")[1]),o=new ymaps.Map("map",{center:[t,s],zoom:16});let u=new ymaps.ObjectManager({clusterize:!0,gridSize:32,clusterDisableClickZoom:!0});u.objects.options.set("preset","islands#greenDotIcon"),u.clusters.options.set("preset","islands#greenClusterIcons"),u.add({type:"Feature",id:n,geometry:{type:"Point",coordinates:[t,s]},properties:{hintContent:a,balloonContentHeader:""}}),o.geoObjects.add(u)}