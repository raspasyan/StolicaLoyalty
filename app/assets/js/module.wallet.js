function drawWallet(d){let a=C("#cardNumber"),n=C("#qrcode").el,r=C("#cardType"),c=C("#cardInfo"),s=C("#currencyType"),l=C("#bonuses"),o=C("#changeDiscountSystemValue");if(d.cardNumber){hide("#wallet-placeholder"),hide("#wallet-loader"),show("#wallet-data"),d.cardNumber&&a.text!==d.cardNumber&&(a.text(d.cardNumber),n.codeNumber!==d.cardNumber&&(n.children.length&&removeChildrens(n),drawBonusCard(d.cardNumber))),C("#discountValue").text(d.discountValue+"%");let e=!1,t=(d.discount&&d.preferredDiscount?(r.text("Дисконтная карта"),c.text("Ваша скидка"),s.text("%"),C("#cardDataDiscount").el.style.display="flex",e=!0):!d.discount&&!d.preferredDiscount||!d.discount&&d.preferredDiscount?(r.text("Бонусная карта"),c.text("Баланс"),s.text("бонусов"),hide("#cardDataBonusPreffered"),hide("#cardDataDiscount")):d.discount&&!d.preferredDiscount&&(r.text("Дисконтная карта"),c.text("Баланс"),s.text("бонусов"),hide("#cardDataDiscount")),d.discount!==d.preferredDiscount?(show("#changeDiscountSystem"),o.text(d.discount?"БОНУСНОЙ":"ДИСКОНТНОЙ")):(hide("#changeDiscountSystem"),o.text("")),d.discount&&e?d.discountValue:d.balance);if(void 0!==t){if(l.text!==t){l.el.classList.remove("load");for(let e=1;e<101;e+=3)promiseTimeout(function(){l.text(Math.trunc(t*(e/100)))},10*e);promiseTimeout(function(){l.text(Math.trunc(t))},1e3)}var i=0;if(void 0!==d.activation){let e=C().create("div"),t=C().create("span"),a=C().create("span"),n=C().create("span");show(".wallet__balanceDetail");var i=Math.trunc(d.activation),p=new Date;p.setDate(p.getDate()+1),t.text(p.toLocaleString("ru-Ru").replace(", ","\r\n")),a.text("+"+i),n.text(" бонусов (активация)"),e.el.append(t.el),a.el.append(n.el),e.el.append(a.el),C(".balance-view").el.append(e.el)}C("#currentBalance").html(Math.trunc(t-i)),void 0!==d.life_times&&(show(".wallet__balanceDetail"),d.life_times.forEach(e=>{let t=C().create("div"),a=C().create("span"),n=C().create("span"),d=C().create("span");a.text(new Date(e.date).toLocaleString("ru-Ru").replace(", ","\r\n")),n.text((0<e.amount?"+":"")+Math.trunc(e.amount)),d.text(" бонусов ("+(0<e.amount?"активация":"списание")+")"),t.el.append(a.el),n.el.append(d.el),t.el.append(n.el),C(".balance-view").el.append(t.el)}))}else l.text("Не удалось загрузить с сервера.")}else show("#wallet-placeholder"),show("#wallet-loader"),hide("#wallet-data")}function drawPurchases(e){e.forEach(e=>drawPurchase(e))}function drawPurchase(n){let r=C().create("div"),e=C().create("div"),t=C().create("span"),a=Math.trunc(Math.abs(n.discount_amount)+Math.abs(n.payment_amount));r.addclass(["animate__animated","animate__fadeIn"]),t.el.style.fontWeight="bold",t.text("Всего скидка: "),e.append(t),(t=C().create("span")).addclass("bad"),t.text((a?"-":"")+a+" руб"),e.append(t),n.operation_type||((t=C().create("span")).addclass("bad"),t.style("fontWeight","bold"),t.style("textAlign","right"),t.style("fontSize","12px"),t.text("чек возврата"),e.append(t)),r.append(e),e=C().create("div"),(t=C().create("span")).addclass("payment-amount"),t.style("fontWeight","bold"),t.style("marginLeft","20px"),t.text("из них бонусами: "),e.append(t),(t=C().create("span")).addclass("bad"),t.text(Math.trunc(n.payment_amount)),e.append(t),r.append(e),e=C().create("div"),(t=C().create("span")).addclass("payment-amount"),t.style("fontWeight","bold"),t.text("Начислено бонусов: "),e.append(t);var d=Math.trunc(n.cashback_amount);(t=C().create("span")).addclass("good"),t.text((0<d?"+":"")+d),e.append(t),r.append(e),(e=C().create("div")).addclass("payment-row-date"),(t=C().create("span")).addclass("payment-amount"),t.text("Дата: "),e.append(t);let c=new Date(n.operation_date.replace(new RegExp("-","g"),"/"));if((t=C().create("span")).text(["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"][c.getDay()]+", "+String(c.getDate())+" "+["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][c.getMonth()]+" "+String(c.getFullYear())+" года, "+String(c.getHours())+":"+(1===String(c.getMinutes()).length?"0":"")+String(c.getMinutes())+":"+(1===String(c.getSeconds()).length?"0":"")+String(c.getSeconds())),e.append(t),r.append(e),(e=C().create("div")).addclass("payment-row-date"),(t=C().create("span")).addclass("payment-amount"),t.text("Магазин: "),e.append(t),n.store_title&&n.store_description?e.append(getGeolink(n.store_title,n.store_description)):((t=C().create("span")).text(n.store_title),e.append(t)),r.append(e),n.positions.length){let e=C().create("details"),t=C().create("summary"),d=C().create("div"),a=C().create("div");r.append(e),t.text("Подробнее"),e.append(t),d.addclass("details-data"),e.append(d),a.addclass(["payment-details","neutral"]),["Оплачено","Скидка","Начислено"].forEach(e=>{let t=C().create("span");t.text(e),a.append(t)}),d.append(a),n.positions.forEach(e=>{let t=C().create("span"),a=C().create("div");a.addclass(["payment-details","important"]),t.text(Math.trunc(e.cost)+" руб"),a.append(t),t=C().create("span"),e.discount_amount?t.text(Math.trunc(-1*e.discount_amount)+" руб"):t.text(Math.trunc(e.payment_amount)+" бонусов");var n=Math.trunc(e.cashback_amount);a.append(t),(t=C().create("span")).text((0<n?"+":"")+n+" бонусов"),a.append(t),d.append(a),(a=C().create("div")).addclass(["payment-details","payment-details-full"]),a.text(e.product_title||"Загрузка.."),d.append(a)})}C("#transactions").el.prepend(r.el)}function drawBonusCard(r){let c=new Image,s=C("#qrcode");c.loaded=!1,c.src=cardImageSRC,c.addEventListener("load",e=>{var t=C().create("canvas");new QRious({element:t.el,size:128,value:r,foreground:"#4062b7"});s.el.cardNumber=r,s.append(t),show("#qrcode");let a=d.createElement("canvas"),n=(a.width=cardImageW,a.height=cardImageH,a.getContext("2d"));n.imageSmoothingEnabled=!1,n.drawImage(c,0,0,cardImageW,cardImageH),n.drawImage(t.el,192,48,128,128),n.font="32px sans-serif",n.textAlign="center",n.fillText(r.substr(0,7),256,216),show("#downloadCard"),C("#downloadCard").el.addEventListener("click",()=>{var e=a.toDataURL("image/jpeg"),t=d.createElement("a");t.href=e,t.download="Stolica - Bonus card - "+r+".jpg",t.click()})})}function getGeolink(e,t){let a=C().create("div"),n=C().create("span");return n.addclass("ymaps-geolink"),n.attr("data-description",t),n.text(e),a.append(n),a}